# yaml-language-server: $schema=https://topaz.sh/schema/config.json
---
# config schema version
version: 3

# logger settings.
logging:
  prod: true
  log_level: trace

# authentication configuration
authentication:
  enabled: false

# debug service settings.
debug:
  enabled: false

# health service settings.
health:
  enabled: true
  listen_address: "0.0.0.0:9494"
  #
# metric service settings.
metrics:
  enabled: true
  listen_address: "0.0.0.0:9696"

# edge directory configuration.
directory:
  # directory store configuration.
  store:
    provider: boltdb

    boltdb:
      db_path: '/data/test.db'
      request_timeout: 5s  # set as default, 5 secs.

authorizer:
  opa:
    instance_id: "-"
    graceful_shutdown_period_seconds: 2
    # max_plugin_wait_time_seconds: 30 set as default
    local_bundles:
      paths: []
      skip_verification: true
    config:
      services:
        ghcr:
          url: https://ghcr.io
          type: "oci"
          response_header_timeout_seconds: 5
      bundles:
        peoplefinder:
          service: ghcr
          resource: "ghcr.io/aserto-policies/policy-peoplefinder-rbac:latest"
          persist: false
          polling:
            min_delay_seconds: 60
            max_delay_seconds: 120

  jwt:
    acceptable_time_skew: 5s

servers:
  topaz:
    services:
      - reader
      - writer
      - authorizer
      - access
      - model
      - importer
      - exporter
    grpc:
      listen_address: "0.0.0.0:9292"
    http:
      listen_address: "0.0.0.0:9393"
      fqdn: ""
      allowed_headers:
        - "Authorization"
        - "Content-Type"
        - "If-Match"
        - "If-None-Match"
        - "Depth"
      allowed_methods:
        - "GET"
        - "POST"
        - "HEAD"
        - "DELETE"
        - "PUT"
        - "PATCH"
        - "PROFIND"
        - "MKCOL"
        - "COPY"
        - "MOVE"
      allowed_origins:
        - http://localhost
        - http://localhost:*
        - https://*.aserto.com
        - https://*aserto-console.netlify.app
      read_timeout: 2s
      read_header_timeout: 2s
      write_timeout: 2s
      idle_timeout: 30s
